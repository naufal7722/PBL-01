<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Boxicons -->
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- My CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />

    <title>Dashboard Keuangan</title>
  </head>
  <body>
    <!-- SIDEBAR -->
    <section id="sidebar">
      <a href="{{ url_for('index') }}" class="brand">
        <i class="bx bxs-wallet"></i>
        <span class="text">KeuanganApp</span>
      </a>

      <ul class="side-menu top">
        <li class="{% if active == 'dashboard' %}active{% endif %}">
          <a href="{{ url_for('index') }}">
            <i class="bx bxs-dashboard"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>

        <li class="{% if active == 'transaksi' %}active{% endif %}">
          <a href="{{ url_for('data_transaksi') }}">
            <i class="bx bxs-credit-card"></i>
            <span class="text">Transaksi</span>
          </a>
        </li>

        <li class="{% if active == 'kategori' %}active{% endif %}">
          <a href="{{ url_for('data_kategori') }}">
            <i class="bx bxs-category"></i>
            <span class="text">Kategori</span>
          </a>
        </li>

        <li class="{% if active == 'anggaran' %}active{% endif %}">
          <a href="{{ url_for('data_anggaran') }}">
            <i class="bx bxs-wallet-alt"></i>
            <span class="text">Anggaran</span>
          </a>
        </li>
      </ul>

      <ul class="side-menu">
        <li>
          <a href="#">
            <i class="bx bxs-cog"></i>
            <span class="text">Settings</span>
          </a>
        </li>
        <li>
          <a href="{{url_for('logout')}}" class="logout">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content">
      <!-- NAVBAR -->
      <nav>
        <i class="bx bx-menu"></i>
        <a href="#" class="nav-link">Dashboard Keuangan</a>
      </nav>
      <!-- NAVBAR -->

      <!-- MAIN -->
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Halo, {{ session['username'] |capitalize }}!</h1>
            <ul class="breadcrumb">
              <li>
                <a href="#">Dashboard</a>
              </li>
              <li><i class="bx bx-chevron-right"></i></li>
              <li>
                <a class="active" href="#">Home</a>
              </li>
            </ul>
          </div>
        </div>

        <!-- INFO BOX -->
        <ul class="box-info" style="margin-bottom: 70px">
          <li>
            <i class="bx bxs-up-arrow-circle"></i>
            <span class="text">
              <h3>Rp{{ "{:,.0f}".format(total_masuk) .replace(",", ".") }}</h3>
              <p>Total Pemasukan</p>
            </span>
          </li>

          <li>
            <i class="bx bxs-down-arrow-circle"></i>
            <span class="text">
              <h3>Rp{{ "{:,.0f}".format(total_keluar) .replace(",", ".") }}</h3>
              <p>Total Pengeluaran</p>
            </span>
          </li>

          <li>
            <i class="bx bxs-wallet"></i>
            <span class="text">
              <h3>Rp{{ "{:,.0f}".format(saldo) .replace(",", ".") }}</h3>
              <p>Saldo</p>
            </span>
          </li>
        </ul>

        <h2 style="margin-bottom: 20px">Anggaran per Kategori (Bulan Ini)</h2>

        {% for a in anggaran_kategori %} {% set anggaran = a[1] | int %} {% set
        keluar = a[2] | int %} {% set persen = (keluar / anggaran * 100) if
        anggaran > 0 else 0 %} {% set sisa = anggaran - keluar %} {% set
        bar_width = persen if persen <= 100 else 100 %} {% set bar_color =
        '#e74c3c' if persen > 100 else '#2ecc71' %}

        <div class="anggaran-item" style="margin-bottom: 20px">
          <strong>{{ a[0] }}</strong>

          <p>Anggaran: Rp{{ "{:,.0f}".format(anggaran)|replace(",", ".") }}</p>
          <p>Terpakai: Rp{{ "{:,.0f}".format(keluar)|replace(",", ".") }}</p>

          <div style="background: #eee; height: 10px; border-radius: 6px">
            <div
              style="
          height:10px;
          width: {{ bar_width }}%;
          background-color: {{ bar_color }};
          border-radius:6px;
        "
            ></div>
          </div>

          {% if sisa >= 0 %}
          <small>Sisa: Rp{{ "{:,.0f}".format(sisa)|replace(",", ".") }}</small>
          {% else %}
          <small style="color: red">
            âš  Lebih: Rp{{ "{:,.0f}".format(sisa|abs)|replace(",", ".") }}
          </small>
          {% endif %}
        </div>
        {% endfor %}

        <!-- TABLE TRANSAKSI -->
        <div class="table-data">
          <div class="order">
            <div class="head">
              <h3>Transaksi Terakhir</h3>
            </div>

            <table>
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Jenis</th>
                  <th>Kategori</th>
                  <th>Nominal</th>
                  <th>Keterangan</th>
                </tr>
              </thead>
              <tbody>
                {% for t in transaksi %}
                <tr>
                  <td>{{ t[1] }}</td>
                  <td>{{ t[2] }}</td>
                  <td>{{ t[3] }}</td>
                  <td>
                    Rp{{ "{:,.0f}".format(t[4]|default(0))|replace(",", ".") }}
                  </td>
                  <td>{{ t[5] }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </main>
      <!-- MAIN -->
    </section>
    <!-- CONTENT -->

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  </body>
</html>
